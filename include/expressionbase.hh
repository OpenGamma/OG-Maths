/**
 * Copyright (C) 2013 - present by OpenGamma Inc. and the OpenGamma group of companies
 *
 * Please see distribution for license.
 */

#ifndef _EXPRESSIONBASE_HH
#define _EXPRESSIONBASE_HH

#include <memory>
#include <vector>
#include "numeric.hh"
#include "visitor.hh"

using namespace std;


/**
 * The namespace for the DAG library
 */
namespace librdag
{

/**
 * Container for expression arguments
 */

typedef vector<OGNumeric::Ptr> ArgContainer;
typedef vector<OGNumeric::Ptr> RegContainer;

/**
 *  Expr type
 */
class OGExpr: public OGNumeric
{
  public:
    typedef std::shared_ptr<const OGExpr> Ptr;
    virtual ~OGExpr();
    const ArgContainer& getArgs() const;
    RegContainer& getRegs() const;
    size_t getNArgs() const;
    virtual OGExpr::Ptr asOGExpr() const override;
    virtual void debug_print() const override;
    virtual void accept(Visitor &v) const override;
  protected:
    OGExpr();
    ArgContainer _args;
  private:
    mutable RegContainer _regs;
};

/**
 * Things that extend OGExpr
 */

class OGUnaryExpr: public OGExpr
{
  protected:
    OGUnaryExpr(OGNumeric::Ptr arg);
};

class OGBinaryExpr : public OGExpr
{
  protected:
    OGBinaryExpr(OGNumeric::Ptr arg0, OGNumeric::Ptr arg1);
};

/**
 * Non-autogenerated nodes
 */

class COPY: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const COPY> Ptr;
    static COPY::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual COPY::Ptr asCOPY() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    COPY(OGNumeric::Ptr arg);
};

class SELECTRESULT: public OGExpr
{
  public:
    typedef std::shared_ptr<const SELECTRESULT> Ptr;
    static SELECTRESULT::Ptr create(OGNumeric::Ptr arg0, OGNumeric::Ptr arg1);
    virtual OGNumeric::Ptr copy() const override;
    virtual SELECTRESULT::Ptr asSELECTRESULT() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    SELECTRESULT(OGNumeric::Ptr arg0, OGNumeric::Ptr arg1);
};

class NORM2: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const NORM2> Ptr;
    static NORM2::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual NORM2::Ptr asNORM2() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    NORM2(OGNumeric::Ptr arg);
};


class PINV: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const PINV> Ptr;
    static PINV::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual PINV::Ptr asPINV() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    PINV(OGNumeric::Ptr arg);
};

class INV: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const INV> Ptr;
    static INV::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual INV::Ptr asINV() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    INV(OGNumeric::Ptr arg);
};


class TRANSPOSE: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const TRANSPOSE> Ptr;
    static TRANSPOSE::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual TRANSPOSE::Ptr asTRANSPOSE() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    TRANSPOSE(OGNumeric::Ptr arg);
};

class CTRANSPOSE: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const CTRANSPOSE> Ptr;
    static CTRANSPOSE::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual CTRANSPOSE::Ptr asCTRANSPOSE() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    CTRANSPOSE(OGNumeric::Ptr arg);
};


class SVD: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const SVD> Ptr;
    static SVD::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual SVD::Ptr asSVD() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    SVD(OGNumeric::Ptr arg);
};

class MTIMES: public OGBinaryExpr
{
  public:
    typedef std::shared_ptr<const MTIMES> Ptr;
    static MTIMES::Ptr create(OGNumeric::Ptr arg0, OGNumeric::Ptr arg1);
    virtual OGNumeric::Ptr copy() const override;
    virtual MTIMES::Ptr asMTIMES() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    MTIMES(OGNumeric::Ptr arg0, OGNumeric::Ptr arg1);
};

class LU: public OGUnaryExpr
{
  public:
    typedef std::shared_ptr<const LU> Ptr;
    static LU::Ptr create(OGNumeric::Ptr arg);
    virtual OGNumeric::Ptr copy() const override;
    virtual LU::Ptr asLU() const override;
    virtual void debug_print() const override;
    virtual ExprType_t getType() const override;
  private:
    LU(OGNumeric::Ptr arg);
};

} // namespace librdag

#endif // _EXPRESSIONBASE_HH
